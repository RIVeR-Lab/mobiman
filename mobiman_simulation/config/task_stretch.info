; robot model meta-information
model_information {
  manipulatorModelType     1      // 0: Default-arm, 1: Wheel-based manipulator, 2: Floating-arm manipulator
  
  ; motion joints in the URDF to consider fixed
  removeJoints {
  }

  ; base frame of the robot (from URDF)
;  baseFrame                "base"
  baseFrame                "base_link"
  ; end-effector frame of the robot (from URDF)
;  eeFrame                  "WRIST_2"
  eeFrame                  "link_wrist_yaw"
}

model_settings
{
  usePreComputation             false
  recompileLibraries            true
}

; DDP settings
ddp
{
  algorithm                     SLQ

  nThreads                      3

  maxNumIterations              10
  minRelCost                    0.1
  constraintTolerance           1e-3

  displayInfo                   false
  displayShortSummary           false
  checkNumericalStability       false

  AbsTolODE                     1e-5
  RelTolODE                     1e-3
  timeStep                      1e-3
  maxNumStepsPerSecond          100000
  backwardPassIntegratorType    ODE45

  inequalityConstraintMu        100.0
  inequalityConstraintDelta     1.1

  preComputeRiccatiTerms        true
  useNominalTimeForBackwardPass false

  useFeedbackPolicy             false

  strategy                      LINE_SEARCH
  lineSearch
  {
    minStepLength                 1e-2
    maxStepLength                 1.0
    hessianCorrectionStrategy     DIAGONAL_SHIFT
    hessianCorrectionMultiple     1e-3
  }
}

; Rollout settings
rollout
{
  AbsTolODE                     1e-5
  RelTolODE                     1e-3
  timeStep                      1e-2
  maxNumStepsPerSecond          100000
  checkNumericalStability       false
}

; MPC settings
mpc
{
  timeHorizon                    1.0
  numPartitions                  4

  runtimeMaxNumIterations        1
  initMaxNumIterations           10

  runtimeMaxStepLength           1.0
  runtimeMinStepLength           1e-2
  initMaxStepLength              1.0
  initMinStepLength              1e-2

  debugPrint                     false
  coldStart                      false

  useParallelRiccatiSolver       true  ; use disjoint riccati solver in MP case and recedingHorizon fashion

  solutionTimeWindow             5.2   ; [s]

  mpcDesiredFrequency            100   ; [Hz]
  mrtDesiredFrequency            400   ; [Hz]
}

; initial state DEFAULT
;initialState
;{
;  (0,0)  0.0  ; position x
;  (1,0)  0.0  ; position y
;  (2,0)  0.0  ; heading
;  (3,0)  2.5  ; SH_ROT
;  (4,0) -1.0  ; SH_FLE
;  (5,0)  1.5  ; EL_FLE
;  (6,0)  0.0  ; EL_ROT
;  (7,0)  1.0  ; WR_FLE
;  (8,0)  0.0  ; WR_ROT
;}

; initial state NUA
initialState
{
  (0,0)  0.0  ; position x
  (1,0)  0.0  ; position y
  (2,0)  0.0  ; heading
  (3,0)  0.0  ; joint_head_pan:
  (4,0)  0.0  ; joint_head_tilt
  (5,0)  0.0  ; joint_lift
  (6,0)  0.0  ; joint_arm_l3
  (7,0)  0.0  ; joint_arm_l2
  (8,0)  0.0  ; joint_arm_l1
  (9,0)  0.0  ; joint_arm_l0
  (10,0)  0.0  ; joint_wrist_yaw
}

inputCost
{
  ; control weight matrix DEFAULT
  ;R
  ;{
  ;  scaling 1e-2

  ;  (0,0)  5.0  ; forward velocity
  ;  (1,1)  5.0  ; turning velocity
  ;  (2,2)  1.0  ; SH_ROT velocity
  ;  (3,3)  1.0  ; SH_FLE velocity
  ;  (4,4)  1.0  ; EL_FLE velocity
  ;  (5,5)  1.0  ; EL_ROT velocity
  ;  (6,6)  1.0  ; WR_FLE velocity
  ;  (7,7)  1.0  ; WR_ROT velocity
  ;}

  ; control weight matrix NUA
  R
  {
    scaling 1e-2

    (0,0)  5.0  ; forward velocity
    (1,1)  5.0  ; turning velocity
    (2,2)  1.0  ; joint_head_pan velocity
    (3,3)  1.0  ; joint_head_tilt velocity
    (4,4)  1.0  ; joint_lift velocity
    (5,5)  1.0  ; joint_arm_l3 velocity
    (6,6)  1.0  ; joint_arm_l2 velocity
    (7,7)  1.0  ; joint_arm_l1 velocity
    (8,8)  1.0  ; joint_arm_l0 velocity
    (9,9)  1.0  ; joint_wrist_yaw velocity
  }
}

endEffector
{
  ; end effector quadratic penalty scaling
  muPosition  10.0
  muOrientation  5.0
}

finalEndEffector
{
  muPosition  10.0
  muOrientation  5.0
}

selfCollision
{ 
  ; activate self-collision constraint
  activate  true

  ; Self Collision raw object pairs
  collisionObjectPairs
  {
    [0] "1, 4"
    [1] "1, 6"
    [2] "1, 9"
  }

  ; Self Collision pairs
  collisionLinkPairs
  {
    [0] "link_arm_l4, link_head_pan"
    [1] "link_arm_l3, link_head_pan"
    [2] "link_arm_l2, link_head_pan"
    [3] "link_that_doesnt_exist, link_arm_l4"
  }

  ; minimum distance allowed between the pairs
  minimumDistance  0.1

  ; relaxed log barrier mu
  mu     1e-2

  ; relaxed log barrier delta
  delta  1e-3
}

jointVelocityLimits
{
  ;lowerBound DEFAULT
  ;{
  ;  (0,0) -0.5  ; forward velocity
  ;  (1,0) -0.5  ; turning velocity
  ;  (2,0) -1.0  ; SH_ROT
  ;  (3,0) -1.0  ; SH_FLE
  ;  (4,0) -1.0  ; EL_FLE
  ;  (5,0) -1.0  ; EL_ROT
  ;  (6,0) -1.0  ; WR_FLE
  ;  (7,0) -1.0  ; WR_ROT
  ;}

  lowerBound
  {
    (0,0) -0.5  ; forward velocity
    (1,0) -0.5  ; turning velocity
    (2,0) -1.0  ; joint_head_pan
    (3,0) -1.0  ; joint_head_tilt
    (4,0) -1.0  ; joint_lift
    (5,0) -1.0  ; joint_arm_l3
    (6,0) -1.0  ; joint_arm_l2
    (7,0) -1.0  ; joint_arm_l1
    (8,0) -1.0  ; joint_arm_l0
    (9,0) -1.0  ; joint_wrist_yaw
  }

  ;upperBound
  ;{
  ;  (0,0) 0.5  ; forward velocity
  ;  (1,0) 0.5  ; turning velocity
  ;  (2,0) 1.0  ; joint_lift
  ;  (3,0) 1.0  ; SH_FLE
  ;  (4,0) 1.0  ; EL_FLE
  ;  (5,0) 1.0  ; EL_ROT
  ;  (6,0) 1.0  ; WR_FLE
  ;  (7,0) 1.0  ; WR_ROT
  ;}

  upperBound
  {
    (0,0) 0.5  ; forward velocity
    (1,0) 0.5  ; turning velocity
    (2,0) 1.0  ; joint_head_pan
    (3,0) 1.0  ; joint_head_tilt
    (4,0) 1.0  ; joint_lift
    (5,0) 1.0  ; joint_arm_l3
    (6,0) 1.0  ; joint_arm_l2
    (7,0) 1.0  ; joint_arm_l1
    (8,0) 1.0  ; joint_arm_l0
    (9,0) 1.0  ; joint_wrist_yaw
  }

  ; relaxed log barrier mu
  mu      0.01

  ; relaxed log barrier delta
  delta   1e-3
}